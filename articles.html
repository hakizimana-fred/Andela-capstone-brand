<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="css/utils.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
     <button onclick="topFunction()" id="myBtn" title="Go to top">
         <i class="fa fa-arrow-up" aria-hidden="true"></i>
     </button>
    <nav>
        <div class="container">
            <h1 class="navbar-brand">Fred.</h1>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="index.html#about">About</a></li>
                <li><a href="index.html#skills">Skills</a></li>
                <li><a href="index.html#work">Work</a></li>
                <li><a href="blog.html">Blog</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="login.html">Login</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="article-card" style="background: #F4F5F5 !important">
            <div class="flex-between" style="padding-bottom: 50px">
                 <img  id="blog-img" alt="">

              <div class="article">
                <h1 class="article-heading"></h1>
                <div class="article-content">
                    <span class="date"></span>
                  
                </div>
            </div>
            </div>

            <div class="article-content" style="padding-bottom: 50px">
                <p class="content-article"></p>
            </div>

            <!-- <div class="article-actions flex">
                <span style="margin-right: 40px;"><i class="fa-solid fa-heart" style="color: #F36D6D"></i>2</span>
                <span><i class="fa-solid fa-comment"></i>3</span>
            </div> -->

            <div  style="width: 100%; border: 1px solid #D7D7D7; "></div>

            <div class="comment-form">
                <form action="" id="comment-form"> 
                     <div class="form-control">
                        <textarea name="comment" placeholder="comment" id="comment"></textarea>
                    </div>
                    <button class="btn btn-primary" type="submit">Post</button>
                </form>
            </div>

            <div class="comments-count"></div>
            <div  style="width: 100%; border: 1px solid #D7D7D7; "></div>

            <div class="comments flex">
               
                <div>
                
                 <div class="comments-content">
                
                </div>
                </div>

            </div>
            <div  style="width: 100%; border: 1px solid #D7D7D7; "></div>
        </div>
    </div>


  <section class="contact flex-column">
        <h1 class="text-md">Contact me</h1>
        <p>if you have any interesting project hit my email</p> 
        <button class="btn btn-email">hello@gmail.com</button>
  </section>



  <div class="footer-socials">
    <div class="socials">
        <a href="#"><i class="fab fa-facebook-f"></i></a>
        <a href="#"><i class="fa-brands fa-twitter"></i></a>
        <a href="#"><i class="fa-brands fa-github"></i></a>
    </div>
  </div>

  <footer class="footer">
    <p>Fred &copy; <span id="year">2022</span></p>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        const idQuery = window.location.search
        const urlParams = new URLSearchParams(idQuery)
        const blogId = urlParams.get('id')

        if (blogId !== "undefined") {
            const blogs = JSON.parse(localStorage.getItem('admin-blog'))
            const foundArticle = blogs.find(blog => blog.blogId === blogId)

            if (foundArticle) {
               // insert Blog content
               document.querySelector('.article-heading').innerHTML = foundArticle.title
               document.querySelector('.date').innerHTML = foundArticle.created
               document.querySelector('.content-article').innerHTML = foundArticle.content
               document.querySelector('#blog-img').src = foundArticle.imgUrl

            }

        }else{
            return window.history.back()
        }
        fetchComments()

    })


    let comments = []
    document.querySelector('.comment-form').addEventListener('submit', (e) => {
        e.preventDefault()
        const idQuery = window.location.search
        const urlParams = new URLSearchParams(idQuery)
        const blogId = urlParams.get('id')

        const commentArea = document.querySelector('#comment').value
        const user = JSON.parse(localStorage.getItem('loggedin-user')) || {}

        const comment = {
            blogId,
            comment: commentArea,
            name:  user?.name,
            created: new Date().toISOString().substring(0,10),
        }

       if (localStorage.getItem('brand-comments') === null) {
          comments.push(comment)
          localStorage.setItem('brand-comments', JSON.stringify(comments))
       }else {
            comments = JSON.parse(localStorage.getItem('brand-comments'))
            comments.push(comment)
            localStorage.setItem('brand-comments', JSON.stringify(comments))
       } 

       fetchComments()
       
    })


    function fetchComments() {
        const idQuery = window.location.search
        const urlParams = new URLSearchParams(idQuery)
        const blogId = urlParams.get('id')

        const comments = JSON.parse(localStorage.getItem('brand-comments'))
        const commentsContent = document.querySelector('.comments-content')
        let output = '' 


        if (comments.length > 0) {
            comments.forEach(comment => {
                if (comment.blogId === blogId) {
                    output += `
                        <div style="width: 100%">
                            <h1 style="font-weight:600;">${comment.name}</h1>
                            <p>${comment.comment}</p>
                            <span>${comment.created}</span>
                        </div>
                    `
                }
            })
            commentsContent.innerHTML = output
        }

    }

  </script>

 <script src="js/main.js"></script>
</body>
</html>